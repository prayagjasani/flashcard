<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Create Deck</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#007AFF",
                        "background-light": "#F9F9F9",
                        "background-dark": "#101622",
                        "neutral-gray": "#8E8E93",
                        "destructive-red": "#FF3B30",
                        "near-black": "#1C1C1E"
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body {
            min-height: 100dvh;
            overflow: hidden;
        }
    </style>
    <style>
        .loading-overlay {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: none;
            background: rgba(255, 255, 255, 0.6);
        }
        
        .loading-overlay.is-active {
            display: grid;
            place-items: center;
        }
        
        .loading-dots {
            display: flex;
            gap: 8px;
            color: #8E8E93;
        }
        
        .loading-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.5;
            animation: dotPulse 1000ms infinite ease-in-out;
        }
        
        .loading-dots span:nth-child(2) {
            animation-delay: 150ms;
        }
        
        .loading-dots span:nth-child(3) {
            animation-delay: 300ms;
        }
        
        @keyframes dotPulse {
            0% {
                transform: scale(1);
                opacity: 0.35;
            }
            50% {
                transform: scale(1.25);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 0.35;
            }
        }
    </style>
</head>

<body class="font-display bg-[#f2f2f7] dark:bg-[#000000]">
    <div class="relative flex min-h-screen w-full flex-col">
        <div id="globalLoader" class="loading-overlay is-active" aria-hidden="true">
            <div class="loading-dots"><span></span><span></span><span></span></div>
        </div>
        <header class="sticky top-0 z-10 flex items-center justify-between border-b border-gray-200/80 bg-[#f2f2f7]/80 px-4 py-3 backdrop-blur-sm dark:border-gray-800/80 dark:bg-[#000000]/80">
            <div class="flex items-center gap-2">
                <button id="backBtn" class="flex size-10 items-center justify-center text-near-black dark:text-white">
      <span class="material-symbols-outlined text-2xl">arrow_back_ios_new</span>
    </button>
            </div>
            <h1 class="text-lg font-semibold text-near-black dark:text-white">Create Deck</h1>
            <div class="w-10"></div>
        </header>
        <main class="flex flex-1 flex-col px-4 pt-6 pb-28">
            <div class="space-y-6">
                <div>
                    <label class="mb-2 block text-sm font-medium text-neutral-gray dark:text-gray-400" for="deck-name">Deck name</label>
                    <input class="block w-full rounded-xl border border-gray-300 bg-white p-3 text-near-black shadow-sm placeholder:text-neutral-gray focus:border-primary focus:ring-1 focus:ring-primary dark:border-gray-700 dark:bg-gray-800/50 dark:text-white" id="deck-name"
                        placeholder="e.g., verbs_de" type="text" />
                </div>
                <div>
                    <label class="mb-2 block text-sm font-medium text-neutral-gray dark:text-gray-400" for="deck-data">Data (english,german per line)</label>
                    <textarea class="block w-full rounded-xl border border-gray-300 bg-white p-3 text-near-black shadow-sm placeholder:text-neutral-gray focus:border-primary focus:ring-1 focus:ring-primary dark:border-gray-700 dark:bg-gray-800/50 dark:text-white" id="deck-data"
                        placeholder="to speak,sprechen
to give,geben
to help,helfen
to eat,essen
to forget,vergessen
(etc)" rows="8"></textarea>
                </div>
            </div>
        </main>
        <div id="actionBar" class="fixed bottom-0 left-0 right-0 z-20 px-4 pb-[calc(env(safe-area-inset-bottom)+12px)] pt-3">
            <div class="mx-auto w-full max-w-xl rounded-2xl bg-[#f2f2f7]/85 backdrop-blur-md shadow-lg border border-gray-200/70 dark:bg-[#000000]/70 dark:border-gray-700/60 p-3">
                <div class="space-y-3">
                    <button id="createBtn" class="w-full rounded-xl bg-primary p-4 text-center font-semibold text-white shadow-sm hover:bg-blue-600">Create</button>
                    <!-- <button id="cancelBtn" class="w-full rounded-xl bg-white p-4 text-center font-semibold text-near-black shadow-sm hover:bg-gray-100 dark:bg-gray-800/50 dark:text-white dark:hover:bg-gray-800">Cancel</button> -->
                </div>
            </div>
            <div class="h-2"></div>
        </div>
    </div>

    <script>
        const cancelBtn = document.getElementById('cancelBtn');
        const createBtn = document.getElementById('createBtn');
        const nameInput = document.getElementById('deck-name');
        const dataInput = document.getElementById('deck-data');
        const globalLoader = document.getElementById('globalLoader');

        function hideLoader() {
            if (globalLoader) globalLoader.classList.remove('is-active');
        }
        document.addEventListener('DOMContentLoaded', hideLoader);
        const backBtn = document.getElementById('backBtn');
        backBtn.addEventListener('click', () => {
            window.location.href = '/';
        });

        function sanitizeDeckName(name) {
            return (name || '').trim().replace(/[^a-zA-Z0-9_\-]+/g, '_').substring(0, 50);
        }
        cancelBtn.addEventListener('click', () => {
            window.location.href = '/';
        });
        createBtn.addEventListener('click', async() => {
            const rawName = nameInput.value;
            const rawData = dataInput.value;
            const name = sanitizeDeckName(rawName);
            if (!name) {
                alert('Please enter a deck name.');
                return;
            }
            if (!rawData.trim()) {
                alert('Please paste deck data.');
                return;
            }
            createBtn.disabled = true;
            createBtn.textContent = 'Saving...';
            try {
                const resp = await fetch('/deck/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        data: rawData
                    })
                });
                const out = await resp.json().catch(() => ({
                    ok: false
                }));
                if (!resp.ok || !out.ok) throw new Error(out.detail || 'Failed to create deck');
                createBtn.textContent = 'Saved';
                setTimeout(() => {
                    window.location.href = '/'
                }, 600);
            } catch (e) {
                alert(String(e.message || e));
                createBtn.disabled = false;
                createBtn.textContent = 'Create';
            }
        });
    </script>

</body>

</html>